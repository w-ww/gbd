{"cells":[{"source":"<a href=\"https://www.kaggle.com/wangjoe/notebook1e875d8140?scriptVersionId=88479959\" target=\"_blank\"><img align=\"left\" alt=\"Kaggle\" title=\"Open in Kaggle\" src=\"https://kaggle.com/static/images/open-in-kaggle.svg\"></a>","metadata":{},"cell_type":"markdown","outputs":[],"execution_count":0},{"cell_type":"code","execution_count":1,"id":"03c3ec0d","metadata":{"_execution_state":"idle","_uuid":"051d70d956493feee0c6d64651c6a088724dca2a","execution":{"iopub.execute_input":"2022-02-22T14:10:16.473214Z","iopub.status.busy":"2022-02-22T14:10:16.470591Z","iopub.status.idle":"2022-02-22T14:10:17.776612Z","shell.execute_reply":"2022-02-22T14:10:17.774425Z"},"papermill":{"duration":1.330757,"end_time":"2022-02-22T14:10:17.776796","exception":false,"start_time":"2022-02-22T14:10:16.446039","status":"completed"},"tags":[]},"outputs":[{"name":"stderr","output_type":"stream","text":["── \u001b[1mAttaching packages\u001b[22m ─────────────────────────────────────── tidyverse 1.3.1 ──\n","\n","\u001b[32m✔\u001b[39m \u001b[34mggplot2\u001b[39m 3.3.5     \u001b[32m✔\u001b[39m \u001b[34mpurrr  \u001b[39m 0.3.4\n","\u001b[32m✔\u001b[39m \u001b[34mtibble \u001b[39m 3.1.5     \u001b[32m✔\u001b[39m \u001b[34mdplyr  \u001b[39m 1.0.7\n","\u001b[32m✔\u001b[39m \u001b[34mtidyr  \u001b[39m 1.1.4     \u001b[32m✔\u001b[39m \u001b[34mstringr\u001b[39m 1.4.0\n","\u001b[32m✔\u001b[39m \u001b[34mreadr  \u001b[39m 2.0.2     \u001b[32m✔\u001b[39m \u001b[34mforcats\u001b[39m 0.5.1\n","\n","── \u001b[1mConflicts\u001b[22m ────────────────────────────────────────── tidyverse_conflicts() ──\n","\u001b[31m✖\u001b[39m \u001b[34mdplyr\u001b[39m::\u001b[32mfilter()\u001b[39m masks \u001b[34mstats\u001b[39m::filter()\n","\u001b[31m✖\u001b[39m \u001b[34mdplyr\u001b[39m::\u001b[32mlag()\u001b[39m    masks \u001b[34mstats\u001b[39m::lag()\n","\n"]},{"data":{"text/html":["'gbddata'"],"text/latex":["'gbddata'"],"text/markdown":["'gbddata'"],"text/plain":["[1] \"gbddata\""]},"metadata":{},"output_type":"display_data"}],"source":["# This R environment comes with many helpful analytics packages installed\n","# It is defined by the kaggle/rstats Docker image: https://github.com/kaggle/docker-rstats\n","# For example, here's a helpful package to load\n","\n","library(tidyverse) # metapackage of all tidyverse packages\n","\n","# Input data files are available in the read-only \"../input/\" directory\n","# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n","\n","list.files(path = \"../input\")\n","\n","# You can write up to 20GB to the current directory (/kaggle/working/) that gets preserved as output when you create a version using \"Save & Run All\" \n","# You can also write temporary files to /kaggle/temp/, but they won't be saved outside of the current session"]},{"cell_type":"code","execution_count":2,"id":"f773f4b6","metadata":{"execution":{"iopub.execute_input":"2022-02-22T14:10:17.871972Z","iopub.status.busy":"2022-02-22T14:10:17.84043Z","iopub.status.idle":"2022-02-22T14:10:17.907948Z","shell.execute_reply":"2022-02-22T14:10:17.906254Z"},"papermill":{"duration":0.103954,"end_time":"2022-02-22T14:10:17.908102","exception":false,"start_time":"2022-02-22T14:10:17.804148","status":"completed"},"tags":[]},"outputs":[],"source":["library(dplyr) \n","library(ggplot2)\n","library(ggsci)"]},{"cell_type":"code","execution_count":3,"id":"35a75dc4","metadata":{"execution":{"iopub.execute_input":"2022-02-22T14:10:17.966072Z","iopub.status.busy":"2022-02-22T14:10:17.963549Z","iopub.status.idle":"2022-02-22T14:10:18.036224Z","shell.execute_reply":"2022-02-22T14:10:18.03387Z"},"papermill":{"duration":0.100129,"end_time":"2022-02-22T14:10:18.036393","exception":false,"start_time":"2022-02-22T14:10:17.936264","status":"completed"},"tags":[]},"outputs":[],"source":["EC <- read.csv('../input/gbddata/EC_region.csv',header = T) \n","order <- read.csv('../input/gbddata/order.csv',header = F)\n","EC$location <- factor(EC$location, \n","                             levels=order$V1, \n","                             ordered=TRUE)"]},{"cell_type":"code","execution_count":4,"id":"0674274b","metadata":{"execution":{"iopub.execute_input":"2022-02-22T14:10:18.095662Z","iopub.status.busy":"2022-02-22T14:10:18.093508Z","iopub.status.idle":"2022-02-22T14:10:18.123171Z","shell.execute_reply":"2022-02-22T14:10:18.12159Z"},"papermill":{"duration":0.056448,"end_time":"2022-02-22T14:10:18.123316","exception":false,"start_time":"2022-02-22T14:10:18.066868","status":"completed"},"tags":[]},"outputs":[],"source":["## 1990EC限定条件取EC的子集\n","EC_1990 <- subset(EC,EC$year==1990 & \n","                    EC$age=='All Ages' & \n","                    EC$metric== 'Number' &\n","                    EC$measure=='Incidence')\n","\n","EC_1990 <- EC_1990[,c(2,8,9,10)]  ### ֻȡ��Ҫ�ı����������Լ���Ӧ����ֵ\n","EC_1990$val <- round(EC_1990$val,1)  ###ȡ��\n","EC_1990$lower <- round(EC_1990$lower,1)###ȡ��\n","EC_1990$upper <- round(EC_1990$upper,1) ###ȡ��\n","EC_1990$Num_1990 <- paste(EC_1990$lower,EC_1990$upper,sep = '-') ## ��-����95%UI������ֵ\n","EC_1990$Num_1990 <- paste(EC_1990$Num_1990,')',sep = '')  ##95%UIǰ�������             \n","EC_1990$Num_1990 <- paste('(',EC_1990$Num_1990,sep = '')  ##95%UIǰ�������\n","EC_1990$Num_1990 <- paste(EC_1990$val,EC_1990$Num_1990,sep = ' ') ##���ݺ�95%UI�ÿո������"]},{"cell_type":"code","execution_count":5,"id":"e18a5a10","metadata":{"execution":{"iopub.execute_input":"2022-02-22T14:10:18.171876Z","iopub.status.busy":"2022-02-22T14:10:18.169766Z","iopub.status.idle":"2022-02-22T14:10:18.201013Z","shell.execute_reply":"2022-02-22T14:10:18.199528Z"},"papermill":{"duration":0.056883,"end_time":"2022-02-22T14:10:18.201154","exception":false,"start_time":"2022-02-22T14:10:18.144271","status":"completed"},"tags":[]},"outputs":[],"source":["## 2019发病人数\n","EC_2019 <- subset(EC,EC$year==2019 & \n","                    EC$age=='All Ages' & \n","                    EC$metric== 'Number' &\n","                    EC$measure=='Incidence')\n","\n","EC_2019 <- EC_2019[,c(2,8,9,10)]  ### ֻȡ��Ҫ�ı����������Լ���Ӧ����ֵ\n","EC_2019$val <- round(EC_2019$val,1)  ###ȡ��\n","EC_2019$lower <- round(EC_2019$lower,1)###ȡ��\n","EC_2019$upper <- round(EC_2019$upper,1) ###ȡ��\n","EC_2019$Num_2019 <- paste(EC_2019$lower,EC_2019$upper,sep = '-') ## ��-����95%UI������ֵ\n","EC_2019$Num_2019 <- paste(EC_2019$Num_2019,')',sep = '')  ##95%UIǰ�������             \n","EC_2019$Num_2019 <- paste('(',EC_2019$Num_2019,sep = '')  ##95%UIǰ�������\n","EC_2019$Num_2019 <- paste(EC_2019$val,EC_2019$Num_2019,sep = ' ') ##���ݺ�95%UI�ÿո������"]},{"cell_type":"code","execution_count":6,"id":"9170db80","metadata":{"execution":{"iopub.execute_input":"2022-02-22T14:10:18.250231Z","iopub.status.busy":"2022-02-22T14:10:18.247707Z","iopub.status.idle":"2022-02-22T14:10:18.285207Z","shell.execute_reply":"2022-02-22T14:10:18.283648Z"},"papermill":{"duration":0.063095,"end_time":"2022-02-22T14:10:18.285354","exception":false,"start_time":"2022-02-22T14:10:18.222259","status":"completed"},"tags":[]},"outputs":[],"source":["## 1990 ASR\n","ASR_1990 <- subset(EC,EC$year==1990 & \n","                    EC$age=='Age-standardized' & \n","                    EC$metric== 'Rate' &\n","                    EC$measure=='Incidence')\n","\n","ASR_1990 <- ASR_1990[,c(2,8,9,10)]  ### ֻȡ��Ҫ�ı����������Լ���Ӧ����ֵ\n","ASR_1990$val <- round(ASR_1990$val,1)  ###ȡ��\n","ASR_1990$lower <- round(ASR_1990$lower,1)###ȡ��\n","ASR_1990$upper <- round(ASR_1990$upper,1) ###ȡ��\n","ASR_1990$ASR_1990 <- paste(ASR_1990$lower,ASR_1990$upper,sep = '-') ## ��-����95%UI������ֵ\n","ASR_1990$ASR_1990 <- paste(ASR_1990$ASR_1990,')',sep = '')  ##95%UIǰ�������             \n","ASR_1990$ASR_1990 <- paste('(',ASR_1990$ASR_1990,sep = '')  ##95%UIǰ�������\n","ASR_1990$ASR_1990 <- paste(ASR_1990$val,ASR_1990$ASR_1990,sep = ' ') ##���ݺ�95%UI�ÿո������"]},{"cell_type":"code","execution_count":7,"id":"51904b37","metadata":{"execution":{"iopub.execute_input":"2022-02-22T14:10:18.334793Z","iopub.status.busy":"2022-02-22T14:10:18.332278Z","iopub.status.idle":"2022-02-22T14:10:18.366707Z","shell.execute_reply":"2022-02-22T14:10:18.364917Z"},"papermill":{"duration":0.060361,"end_time":"2022-02-22T14:10:18.366874","exception":false,"start_time":"2022-02-22T14:10:18.306513","status":"completed"},"tags":[]},"outputs":[],"source":["## 2019 ASR\n","ASR_2019 <- subset(EC,EC$year==2019 & \n","                     EC$age=='Age-standardized' & \n","                     EC$metric== 'Rate' &\n","                     EC$measure=='Incidence')\n","\n","ASR_2019 <- ASR_2019[,c(2,8,9,10)]  ### ֻȡ��Ҫ�ı����������Լ���Ӧ����ֵ\n","ASR_2019$val <- round(ASR_2019$val,1)  ###ȡ��\n","ASR_2019$lower <- round(ASR_2019$lower,1)###ȡ��\n","ASR_2019$upper <- round(ASR_2019$upper,1) ###ȡ��\n","ASR_2019$ASR_2019 <- paste(ASR_2019$lower,ASR_2019$upper,sep = '-') ## ��-����95%UI������ֵ\n","ASR_2019$ASR_2019 <- paste(ASR_2019$ASR_2019,')',sep = '')  ##95%UIǰ�������             \n","ASR_2019$ASR_2019 <- paste('(',ASR_2019$ASR_2019,sep = '')  ##95%UIǰ�������\n","ASR_2019$ASR_2019 <- paste(ASR_2019$val,ASR_2019$ASR_2019,sep = ' ') ##���ݺ�95%UI�ÿո������\n","\n","EC_incidence <- subset(EC, EC$age_name=='Age-standardized' & \n","                         EC$metric_name== 'Rate' &\n","                         EC$measure_name=='Incidence')"]},{"cell_type":"code","execution_count":8,"id":"4038e217","metadata":{"execution":{"iopub.execute_input":"2022-02-22T14:10:18.415734Z","iopub.status.busy":"2022-02-22T14:10:18.414714Z","iopub.status.idle":"2022-02-22T14:10:18.519095Z","shell.execute_reply":"2022-02-22T14:10:18.517489Z"},"papermill":{"duration":0.130914,"end_time":"2022-02-22T14:10:18.51924","exception":false,"start_time":"2022-02-22T14:10:18.388326","status":"completed"},"tags":[]},"outputs":[],"source":["##### EAPC\n","EAPC <- subset(EC, EC$age=='Age-standardized' & \n","                 EC$metric== 'Rate' &\n","                 EC$measure=='Incidence')\n","EAPC <- EAPC[,c(2,7,8)] ##��ȡ����������Լ���Ӧ����ֵ\n","\n","\n","\n","country <- EC_1990$location\n","EAPC_cal <- data.frame(location=country,EAPC=rep(0,times=22),UCI=rep(0,times=22),LCI=rep(0,times=22)) \n","for (i in 1:22){  ###总共22个地区\n","  country_cal <- as.character(EAPC_cal[i,1]) ### ����ȡ��Ӧ�ĵ���\n","  a <- subset(EAPC, EAPC$location==country_cal)  ##ȡ��Ӧ�����������Ӽ�\n","  a$y <- log(a$val)  ##����EAPC���㷽������yֵ\n","  mod_simp_reg<-lm(y~year,data=a) ##����EAPC���㷽�������Իع鷽��\n","  estimate <- (exp(summary(mod_simp_reg)[[\"coefficients\"]][2,1])-1)*100 ##����EAPC���㷽��ȡ����betaֵ������EAPC\n","  low <- (exp(summary(mod_simp_reg)[[\"coefficients\"]][2,1]-1.96*summary(mod_simp_reg)[[\"coefficients\"]][2,2])-1)*100\n","  ### ����EAPC��95%�������������ֵ\n","  high <- (exp(summary(mod_simp_reg)[[\"coefficients\"]][2,1]+1.96*summary(mod_simp_reg)[[\"coefficients\"]][2,2])-1)*100\n","  ### ����EAPC��95%�������������ֵ\n","  EAPC_cal[i,2] <- estimate\n","  EAPC_cal[i,4] <- low\n","  EAPC_cal[i,3] <- high\n","}"]},{"cell_type":"code","execution_count":null,"id":"ab534edb","metadata":{"papermill":{"duration":0.021887,"end_time":"2022-02-22T14:10:18.563281","exception":false,"start_time":"2022-02-22T14:10:18.541394","status":"completed"},"tags":[]},"outputs":[],"source":[]}],"metadata":{"kernelspec":{"display_name":"R","language":"R","name":"ir"},"language_info":{"codemirror_mode":"r","file_extension":".r","mimetype":"text/x-r-source","name":"R","pygments_lexer":"r","version":"4.0.5"},"papermill":{"default_parameters":{},"duration":5.560687,"end_time":"2022-02-22T14:10:18.697177","environment_variables":{},"exception":null,"input_path":"__notebook__.ipynb","output_path":"__notebook__.ipynb","parameters":{},"start_time":"2022-02-22T14:10:13.13649","version":"2.3.3"}},"nbformat":4,"nbformat_minor":5}